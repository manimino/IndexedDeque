
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>hashindex package &#8212; hashindex 0.5.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="hashindex-package">
<h1>hashindex package<a class="headerlink" href="#hashindex-package" title="Permalink to this headline">¶</a></h1>
<section id="submodules">
<h2>Submodules<a class="headerlink" href="#submodules" title="Permalink to this headline">¶</a></h2>
</section>
<section id="module-hashindex.constants">
<span id="hashindex-constants-module"></span><h2>hashindex.constants module<a class="headerlink" href="#module-hashindex.constants" title="Permalink to this headline">¶</a></h2>
</section>
<section id="module-hashindex.exceptions">
<span id="hashindex-exceptions-module"></span><h2>hashindex.exceptions module<a class="headerlink" href="#module-hashindex.exceptions" title="Permalink to this headline">¶</a></h2>
<dl class="py exception">
<dt class="sig sig-object py" id="hashindex.exceptions.FrozenError">
<em class="property"><span class="pre">exception</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">hashindex.exceptions.</span></span><span class="sig-name descname"><span class="pre">FrozenError</span></span><a class="headerlink" href="#hashindex.exceptions.FrozenError" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">Exception</span></code></p>
<p>Raised when attempting to modify a FrozenIndex</p>
</dd></dl>

<dl class="py exception">
<dt class="sig sig-object py" id="hashindex.exceptions.MissingIndexError">
<em class="property"><span class="pre">exception</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">hashindex.exceptions.</span></span><span class="sig-name descname"><span class="pre">MissingIndexError</span></span><a class="headerlink" href="#hashindex.exceptions.MissingIndexError" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">Exception</span></code></p>
<p>Raised when querying a field we don’t have an index for</p>
</dd></dl>

<dl class="py exception">
<dt class="sig sig-object py" id="hashindex.exceptions.MissingObjectError">
<em class="property"><span class="pre">exception</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">hashindex.exceptions.</span></span><span class="sig-name descname"><span class="pre">MissingObjectError</span></span><a class="headerlink" href="#hashindex.exceptions.MissingObjectError" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">Exception</span></code></p>
<p>Raised when removing or updating an object we don’t have.</p>
</dd></dl>

<dl class="py exception">
<dt class="sig sig-object py" id="hashindex.exceptions.MissingValueError">
<em class="property"><span class="pre">exception</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">hashindex.exceptions.</span></span><span class="sig-name descname"><span class="pre">MissingValueError</span></span><a class="headerlink" href="#hashindex.exceptions.MissingValueError" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">Exception</span></code></p>
<p>Raised when adding an object that is missing a field we need to index</p>
</dd></dl>

<dl class="py exception">
<dt class="sig sig-object py" id="hashindex.exceptions.StaleObjectRemovalError">
<em class="property"><span class="pre">exception</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">hashindex.exceptions.</span></span><span class="sig-name descname"><span class="pre">StaleObjectRemovalError</span></span><a class="headerlink" href="#hashindex.exceptions.StaleObjectRemovalError" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">Exception</span></code></p>
<p>Raised when attempting to remove an object that was modified elsewhere.</p>
</dd></dl>

</section>
<section id="module-hashindex.frozen">
<span id="hashindex-frozen-module"></span><h2>hashindex.frozen module<a class="headerlink" href="#module-hashindex.frozen" title="Permalink to this headline">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="hashindex.frozen.FrozenHashIndex">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">hashindex.frozen.</span></span><span class="sig-name descname"><span class="pre">FrozenHashIndex</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">objs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">on</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Callable</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#hashindex.frozen.FrozenHashIndex" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<dl class="py method">
<dt class="sig sig-object py" id="hashindex.frozen.FrozenHashIndex.find">
<span class="sig-name descname"><span class="pre">find</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">match</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Callable</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">exclude</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Callable</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">numpy.ndarray</span></span></span><a class="headerlink" href="#hashindex.frozen.FrozenHashIndex.find" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="hashindex.frozen.FrozenHashIndex.find_ids">
<span class="sig-name descname"><span class="pre">find_ids</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">match</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Callable</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">exclude</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Callable</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">numpy.ndarray</span></span></span><a class="headerlink" href="#hashindex.frozen.FrozenHashIndex.find_ids" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

</section>
<section id="module-hashindex.frozen_buckets">
<span id="hashindex-frozen-buckets-module"></span><h2>hashindex.frozen_buckets module<a class="headerlink" href="#module-hashindex.frozen_buckets" title="Permalink to this headline">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="hashindex.frozen_buckets.ArrayPair">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">hashindex.frozen_buckets.</span></span><span class="sig-name descname"><span class="pre">ArrayPair</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">id_arr</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">numpy.ndarray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">obj_arr</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">numpy.ndarray</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#hashindex.frozen_buckets.ArrayPair" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<dl class="py method">
<dt class="sig sig-object py" id="hashindex.frozen_buckets.ArrayPair.apply_difference">
<span class="sig-name descname"><span class="pre">apply_difference</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">other</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#hashindex.frozen_buckets.ArrayPair.apply_difference" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute the difference of self and other. Preserves sort order. Update this object to the result.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="hashindex.frozen_buckets.ArrayPair.apply_intersection">
<span class="sig-name descname"><span class="pre">apply_intersection</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">other</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#hashindex.frozen_buckets.ArrayPair.apply_intersection" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute the intersection of self and other. Preserves sort order. Update this object to the result.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="hashindex.frozen_buckets.ArrayPair.apply_union">
<span class="sig-name descname"><span class="pre">apply_union</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">other</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#hashindex.frozen_buckets.ArrayPair.apply_union" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute the sorted of self and other. Preserves sort order. Update this object to the result.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="hashindex.frozen_buckets.ArrayPair.id_arr">
<span class="sig-name descname"><span class="pre">id_arr</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">numpy.ndarray</span></em><a class="headerlink" href="#hashindex.frozen_buckets.ArrayPair.id_arr" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="hashindex.frozen_buckets.ArrayPair.obj_arr">
<span class="sig-name descname"><span class="pre">obj_arr</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">numpy.ndarray</span></em><a class="headerlink" href="#hashindex.frozen_buckets.ArrayPair.obj_arr" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="hashindex.frozen_buckets.FDictBucket">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">hashindex.frozen_buckets.</span></span><span class="sig-name descname"><span class="pre">FDictBucket</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">bp</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#hashindex.init_helpers.BucketPlan" title="hashindex.init_helpers.BucketPlan"><span class="pre">hashindex.init_helpers.BucketPlan</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">field</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Callable</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#hashindex.frozen_buckets.FDictBucket" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<dl class="py method">
<dt class="sig sig-object py" id="hashindex.frozen_buckets.FDictBucket.get">
<span class="sig-name descname"><span class="pre">get</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">val</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#hashindex.frozen_buckets.FDictBucket.get" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="hashindex.frozen_buckets.FDictBucket.get_all">
<span class="sig-name descname"><span class="pre">get_all</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#hashindex.frozen_buckets.FDictBucket.get_all" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="hashindex.frozen_buckets.FDictBucketIterator">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">hashindex.frozen_buckets.</span></span><span class="sig-name descname"><span class="pre">FDictBucketIterator</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fdb</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#hashindex.frozen_buckets.FDictBucket" title="hashindex.frozen_buckets.FDictBucket"><span class="pre">hashindex.frozen_buckets.FDictBucket</span></a></span></em><span class="sig-paren">)</span><a class="headerlink" href="#hashindex.frozen_buckets.FDictBucketIterator" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="hashindex.frozen_buckets.FHashBucket">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">hashindex.frozen_buckets.</span></span><span class="sig-name descname"><span class="pre">FHashBucket</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">bp</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#hashindex.init_helpers.BucketPlan" title="hashindex.init_helpers.BucketPlan"><span class="pre">hashindex.init_helpers.BucketPlan</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">field</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Callable</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#hashindex.frozen_buckets.FHashBucket" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<dl class="py method">
<dt class="sig sig-object py" id="hashindex.frozen_buckets.FHashBucket.get">
<span class="sig-name descname"><span class="pre">get</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">val</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#hashindex.frozen_buckets.FHashBucket.get" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="hashindex.frozen_buckets.FHashBucket.get_all">
<span class="sig-name descname"><span class="pre">get_all</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#hashindex.frozen_buckets.FHashBucket.get_all" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="hashindex.frozen_buckets.FHashBucketIterator">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">hashindex.frozen_buckets.</span></span><span class="sig-name descname"><span class="pre">FHashBucketIterator</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fhb</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#hashindex.frozen_buckets.FHashBucket" title="hashindex.frozen_buckets.FHashBucket"><span class="pre">hashindex.frozen_buckets.FHashBucket</span></a></span></em><span class="sig-paren">)</span><a class="headerlink" href="#hashindex.frozen_buckets.FHashBucketIterator" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="hashindex.frozen_buckets.empty_array_pair">
<span class="sig-prename descclassname"><span class="pre">hashindex.frozen_buckets.</span></span><span class="sig-name descname"><span class="pre">empty_array_pair</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#hashindex.frozen_buckets.ArrayPair" title="hashindex.frozen_buckets.ArrayPair"><span class="pre">hashindex.frozen_buckets.ArrayPair</span></a></span></span><a class="headerlink" href="#hashindex.frozen_buckets.empty_array_pair" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="hashindex.frozen_buckets.make_array_pair">
<span class="sig-prename descclassname"><span class="pre">hashindex.frozen_buckets.</span></span><span class="sig-name descname"><span class="pre">make_array_pair</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">obj_arr</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">numpy.ndarray</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#hashindex.frozen_buckets.make_array_pair" title="Permalink to this definition">¶</a></dt>
<dd><p>Finds obj_ids and sorts obj_arr by the ids. Returns an ArrayPair.</p>
</dd></dl>

</section>
<section id="module-hashindex.frozen_field">
<span id="hashindex-frozen-field-module"></span><h2>hashindex.frozen_field module<a class="headerlink" href="#module-hashindex.frozen_field" title="Permalink to this headline">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="hashindex.frozen_field.FrozenFieldIndex">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">hashindex.frozen_field.</span></span><span class="sig-name descname"><span class="pre">FrozenFieldIndex</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">field</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Callable</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bucket_plans</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#hashindex.init_helpers.BucketPlan" title="hashindex.init_helpers.BucketPlan"><span class="pre">hashindex.init_helpers.BucketPlan</span></a><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#hashindex.frozen_field.FrozenFieldIndex" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<dl class="py method">
<dt class="sig sig-object py" id="hashindex.frozen_field.FrozenFieldIndex.get">
<span class="sig-name descname"><span class="pre">get</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">val</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#hashindex.frozen_buckets.ArrayPair" title="hashindex.frozen_buckets.ArrayPair"><span class="pre">hashindex.frozen_buckets.ArrayPair</span></a></span></span><a class="headerlink" href="#hashindex.frozen_field.FrozenFieldIndex.get" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="hashindex.frozen_field.FrozenFieldIndex.get_all">
<span class="sig-name descname"><span class="pre">get_all</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#hashindex.frozen_buckets.ArrayPair" title="hashindex.frozen_buckets.ArrayPair"><span class="pre">hashindex.frozen_buckets.ArrayPair</span></a></span></span><a class="headerlink" href="#hashindex.frozen_field.FrozenFieldIndex.get_all" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="hashindex.frozen_field.FrozenFieldIndex.get_obj_ids">
<span class="sig-name descname"><span class="pre">get_obj_ids</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">val</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">numpy.ndarray</span></span></span><a class="headerlink" href="#hashindex.frozen_field.FrozenFieldIndex.get_obj_ids" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="hashindex.frozen_field.FrozenFieldIndexIterator">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">hashindex.frozen_field.</span></span><span class="sig-name descname"><span class="pre">FrozenFieldIndexIterator</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ffi</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#hashindex.frozen_field.FrozenFieldIndex" title="hashindex.frozen_field.FrozenFieldIndex"><span class="pre">hashindex.frozen_field.FrozenFieldIndex</span></a></span></em><span class="sig-paren">)</span><a class="headerlink" href="#hashindex.frozen_field.FrozenFieldIndexIterator" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
</dd></dl>

</section>
<section id="module-hashindex.init_helpers">
<span id="hashindex-init-helpers-module"></span><h2>hashindex.init_helpers module<a class="headerlink" href="#module-hashindex.init_helpers" title="Permalink to this headline">¶</a></h2>
<p>When HashIndex is initialized with objects, it would be slow to add the objects one at a time. Instead, we can
analyze the list of objects, plan out which buckets will be created, and put the objects in those buckets.</p>
<p>There is a ~10X performance benefit to examining the objs and constructing all the needed buckets just once.</p>
<p>The functions here provide that speedup. They have been squeezed pretty hard for performance. It matters here!
Building the index is most likely going to be the bottleneck when working with large datasets, especially in the
expected applications for this library.</p>
<dl class="simple">
<dt>Workflow:</dt><dd><ul class="simple">
<li><p>Hash the given attribute for all objs</p></li>
<li><p>Sort the hashes</p></li>
<li><p>Get counts of each unique hash (via run-length encoding)</p></li>
<li><p>Use a cumulative sum-like algorithm to determine the span of each bucket</p></li>
<li><p>Return all information that init needs to create buckets containing the objects (a list of <cite>BucketPlan</cite>)</p></li>
</ul>
</dd>
</dl>
<p>Running the workflow takes between 600ms (low-cardinality case) and 800ms (high-cardinality case) on a 1M-item dataset.</p>
<dl class="py class">
<dt class="sig sig-object py" id="hashindex.init_helpers.BucketPlan">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">hashindex.init_helpers.</span></span><span class="sig-name descname"><span class="pre">BucketPlan</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">distinct_hashes</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">numpy.ndarray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">distinct_hash_counts</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">numpy.ndarray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">obj_arr</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">numpy.ndarray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hash_arr</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">numpy.ndarray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">val_arr</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">numpy.ndarray</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#hashindex.init_helpers.BucketPlan" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<dl class="py attribute">
<dt class="sig sig-object py" id="hashindex.init_helpers.BucketPlan.distinct_hash_counts">
<span class="sig-name descname"><span class="pre">distinct_hash_counts</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">numpy.ndarray</span></em><a class="headerlink" href="#hashindex.init_helpers.BucketPlan.distinct_hash_counts" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="hashindex.init_helpers.BucketPlan.distinct_hashes">
<span class="sig-name descname"><span class="pre">distinct_hashes</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">numpy.ndarray</span></em><a class="headerlink" href="#hashindex.init_helpers.BucketPlan.distinct_hashes" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="hashindex.init_helpers.BucketPlan.hash_arr">
<span class="sig-name descname"><span class="pre">hash_arr</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">numpy.ndarray</span></em><a class="headerlink" href="#hashindex.init_helpers.BucketPlan.hash_arr" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="hashindex.init_helpers.BucketPlan.obj_arr">
<span class="sig-name descname"><span class="pre">obj_arr</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">numpy.ndarray</span></em><a class="headerlink" href="#hashindex.init_helpers.BucketPlan.obj_arr" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="hashindex.init_helpers.BucketPlan.val_arr">
<span class="sig-name descname"><span class="pre">val_arr</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">numpy.ndarray</span></em><a class="headerlink" href="#hashindex.init_helpers.BucketPlan.val_arr" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="hashindex.init_helpers.compute_buckets">
<span class="sig-prename descclassname"><span class="pre">hashindex.init_helpers.</span></span><span class="sig-name descname"><span class="pre">compute_buckets</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">objs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">field</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bucket_size_limit</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#hashindex.init_helpers.compute_buckets" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="hashindex.init_helpers.empty_plan">
<span class="sig-prename descclassname"><span class="pre">hashindex.init_helpers.</span></span><span class="sig-name descname"><span class="pre">empty_plan</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#hashindex.init_helpers.empty_plan" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="hashindex.init_helpers.find_bucket_starts">
<span class="sig-prename descclassname"><span class="pre">hashindex.init_helpers.</span></span><span class="sig-name descname"><span class="pre">find_bucket_starts</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">counts</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">limit</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#hashindex.init_helpers.find_bucket_starts" title="Permalink to this definition">¶</a></dt>
<dd><p>Find the start positions for each bucket via a cumulative sum that resets when limit is exceeded.</p>
<dl class="simple">
<dt>inputs:</dt><dd><p>counts, a histogram of the number of values with each hash, e.g. [1 1000 1 1 1 1]
limit, a maximum of how many items can fit in a multi-item bucket</p>
</dd>
<dt>output:</dt><dd><p>an array of start positions such that each bucket multi-item bucket contains &lt;= limit values
e.g. [0, 1, 2] for the example input</p>
</dd>
</dl>
<p>Note: This function is ridiculously faster (like 300x) if decorated with &#64;numba.njit.
However, numba is a difficult dependency to add, as it conflicts with recent numpy. And numpy updates
are constantly required due to security updates. So, we can’t use numba here, despite its amazing performance.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="hashindex.init_helpers.get_sorted_hashes">
<span class="sig-prename descclassname"><span class="pre">hashindex.init_helpers.</span></span><span class="sig-name descname"><span class="pre">get_sorted_hashes</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">objs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">field</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">Callable</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">numpy.ndarray</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">numpy.ndarray</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">numpy.ndarray</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#hashindex.init_helpers.get_sorted_hashes" title="Permalink to this definition">¶</a></dt>
<dd><p>Hash the given attribute for all objs. Sort objs and hashes by the hashes.</p>
<p>Takes 450ms for 1M objs on a numeric field. May take longer if field is a Callable or is hard to hash.
Breakdown:</p>
<blockquote>
<div><ul class="simple">
<li><p>100ms to do all the get_field() calls. Cost is the part that inspects each obj to see if it’s a dict.</p></li>
<li><p>220ms to get and hash the field for each obj. No getting around that.</p></li>
<li><p>100ms to sort the hashes</p></li>
<li><p>30ms of whatever</p></li>
</ul>
</div></blockquote>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="hashindex.init_helpers.run_length_encode">
<span class="sig-prename descclassname"><span class="pre">hashindex.init_helpers.</span></span><span class="sig-name descname"><span class="pre">run_length_encode</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sorted_hashes</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">numpy.ndarray</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#hashindex.init_helpers.run_length_encode" title="Permalink to this definition">¶</a></dt>
<dd><p>Find counts of each hash in sorted_hashes via run-length encoding.</p>
<p>Takes 10ms for 1M objs.</p>
</dd></dl>

</section>
<section id="module-hashindex.mutable">
<span id="hashindex-mutable-module"></span><h2>hashindex.mutable module<a class="headerlink" href="#module-hashindex.mutable" title="Permalink to this headline">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="hashindex.mutable.HashIndex">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">hashindex.mutable.</span></span><span class="sig-name descname"><span class="pre">HashIndex</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">objs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">on</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Callable</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#hashindex.mutable.HashIndex" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<dl class="py method">
<dt class="sig sig-object py" id="hashindex.mutable.HashIndex.add">
<span class="sig-name descname"><span class="pre">add</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">obj</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#hashindex.mutable.HashIndex.add" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="hashindex.mutable.HashIndex.find">
<span class="sig-name descname"><span class="pre">find</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">match</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Callable</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">exclude</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Callable</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">List</span></span></span><a class="headerlink" href="#hashindex.mutable.HashIndex.find" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="hashindex.mutable.HashIndex.find_ids">
<span class="sig-name descname"><span class="pre">find_ids</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">match</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Callable</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">exclude</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Callable</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">cykhash.khashsets.Int64Set</span></span></span><a class="headerlink" href="#hashindex.mutable.HashIndex.find_ids" title="Permalink to this definition">¶</a></dt>
<dd><p>Perform lookup based on given values. Return a set of object IDs matching constraints.</p>
<p>If “having” is None / empty, it matches all objects.
There is an implicit “AND” joining all constraints.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="hashindex.mutable.HashIndex.remove">
<span class="sig-name descname"><span class="pre">remove</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">obj</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#hashindex.mutable.HashIndex.remove" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

</section>
<section id="module-hashindex.mutable_bucket_manager">
<span id="hashindex-mutable-bucket-manager-module"></span><h2>hashindex.mutable_bucket_manager module<a class="headerlink" href="#module-hashindex.mutable_bucket_manager" title="Permalink to this headline">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="hashindex.mutable_bucket_manager.MutableBucketManager">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">hashindex.mutable_bucket_manager.</span></span><span class="sig-name descname"><span class="pre">MutableBucketManager</span></span><a class="headerlink" href="#hashindex.mutable_bucket_manager.MutableBucketManager" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<dl class="py method">
<dt class="sig sig-object py" id="hashindex.mutable_bucket_manager.MutableBucketManager.get_bucket_key_for">
<span class="sig-name descname"><span class="pre">get_bucket_key_for</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">val_hash</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#hashindex.mutable_bucket_manager.MutableBucketManager.get_bucket_key_for" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="hashindex.mutable_bucket_manager.MutableBucketManager.get_neighbors">
<span class="sig-name descname"><span class="pre">get_neighbors</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">bkey</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#hashindex.mutable_bucket_manager.MutableBucketManager.get_neighbors" title="Permalink to this definition">¶</a></dt>
<dd><p>Find the key of the buckets on the left and right of this one, if any.</p>
<p>Used when splitting or removing buckets, as part of ensuring there are no gaps in the hashspace.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="hashindex.mutable_bucket_manager.MutableBucketManager.pop">
<span class="sig-name descname"><span class="pre">pop</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">bkey</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#hashindex.mutable_buckets.HashBucket" title="hashindex.mutable_buckets.HashBucket"><span class="pre">hashindex.mutable_buckets.HashBucket</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference internal" href="#hashindex.mutable_buckets.DictBucket" title="hashindex.mutable_buckets.DictBucket"><span class="pre">hashindex.mutable_buckets.DictBucket</span></a><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#hashindex.mutable_bucket_manager.MutableBucketManager.pop" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="hashindex.mutable_bucket_manager.MutableBucketManager.remove_bucket">
<span class="sig-name descname"><span class="pre">remove_bucket</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">bkey</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#hashindex.mutable_bucket_manager.MutableBucketManager.remove_bucket" title="Permalink to this definition">¶</a></dt>
<dd><p>Remove a bucket.</p>
<p>If this creates a gap in the [HASH_MIN..HASH_MAX] space that is not covered by a bucket, fix that first.</p>
</dd></dl>

</dd></dl>

</section>
<section id="module-hashindex.mutable_buckets">
<span id="hashindex-mutable-buckets-module"></span><h2>hashindex.mutable_buckets module<a class="headerlink" href="#module-hashindex.mutable_buckets" title="Permalink to this headline">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="hashindex.mutable_buckets.DictBucket">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">hashindex.mutable_buckets.</span></span><span class="sig-name descname"><span class="pre">DictBucket</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">val_hash</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">objs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">obj_ids</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vals</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">field</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Callable</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#hashindex.mutable_buckets.DictBucket" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>A DictBucket stores object ids corresponding to only one val_hash. Note that multiple values
could have the same val_hash (collision), but usually this bucket will contain just one value.
It stores all entries in a dict of {val: obj_id_set}, so it supports lookup by field value.
This makes finding objects by val very fast. Unlike a HashBucket, we don’t have to dereference
all the objects and check their values during a find().
DictBucket is great when many objects have the same val.</p>
<dl class="py method">
<dt class="sig sig-object py" id="hashindex.mutable_buckets.DictBucket.add">
<span class="sig-name descname"><span class="pre">add</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">val</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">obj_id</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#hashindex.mutable_buckets.DictBucket.add" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="hashindex.mutable_buckets.DictBucket.get_matching_ids">
<span class="sig-name descname"><span class="pre">get_matching_ids</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">val</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#hashindex.mutable_buckets.DictBucket.get_matching_ids" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="hashindex.mutable_buckets.DictBucket.remove">
<span class="sig-name descname"><span class="pre">remove</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">val</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">obj_id</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#hashindex.mutable_buckets.DictBucket.remove" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="hashindex.mutable_buckets.HashBucket">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">hashindex.mutable_buckets.</span></span><span class="sig-name descname"><span class="pre">HashBucket</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">obj_ids</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">cykhash.khashsets.Int64Set</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#hashindex.mutable_buckets.HashBucket" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>A HashBucket contains all obj_ids that have value hashes between some min and max value.
When the number of items in a HashBucket reaches SIZE_THRESH, the bucket will be split
into two buckets.</p>
<dl class="py method">
<dt class="sig sig-object py" id="hashindex.mutable_buckets.HashBucket.add">
<span class="sig-name descname"><span class="pre">add</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">obj_id</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#hashindex.mutable_buckets.HashBucket.add" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="hashindex.mutable_buckets.HashBucket.dump_some_out_maybe">
<span class="sig-name descname"><span class="pre">dump_some_out_maybe</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">field</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">obj_map</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">cykhash.khashsets.Int64Set</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">cykhash.khashsets.Int64Set</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#hashindex.mutable_buckets.HashBucket.dump_some_out_maybe" title="Permalink to this definition">¶</a></dt>
<dd><p>When a hashbucket is overfilled, dump some out maybe.</p>
<p>Or maybe we only have 1 unique hash, and this should be a dictbucket.
Returns (dumped_ids, None) or (None, dict_for_a_dict_bucket), depending.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="hashindex.mutable_buckets.HashBucket.get_all_ids">
<span class="sig-name descname"><span class="pre">get_all_ids</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#hashindex.mutable_buckets.HashBucket.get_all_ids" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="hashindex.mutable_buckets.HashBucket.remove">
<span class="sig-name descname"><span class="pre">remove</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">_</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">obj_id</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#hashindex.mutable_buckets.HashBucket.remove" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

</section>
<section id="module-hashindex.mutable_field">
<span id="hashindex-mutable-field-module"></span><h2>hashindex.mutable_field module<a class="headerlink" href="#module-hashindex.mutable_field" title="Permalink to this headline">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="hashindex.mutable_field.MutableFieldIndex">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">hashindex.mutable_field.</span></span><span class="sig-name descname"><span class="pre">MutableFieldIndex</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">field</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">Callable</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">obj_map</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bucket_plans</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#hashindex.init_helpers.BucketPlan" title="hashindex.init_helpers.BucketPlan"><span class="pre">hashindex.init_helpers.BucketPlan</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#hashindex.mutable_field.MutableFieldIndex" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Stores the possible values of this field in a collection of buckets.
Several values may be allocated to the same bucket for space efficiency reasons.</p>
<dl class="py method">
<dt class="sig sig-object py" id="hashindex.mutable_field.MutableFieldIndex.add">
<span class="sig-name descname"><span class="pre">add</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">obj_id</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">obj</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#hashindex.mutable_field.MutableFieldIndex.add" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="hashindex.mutable_field.MutableFieldIndex.get_obj_ids">
<span class="sig-name descname"><span class="pre">get_obj_ids</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">val</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#hashindex.mutable_field.MutableFieldIndex.get_obj_ids" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="hashindex.mutable_field.MutableFieldIndex.remove">
<span class="sig-name descname"><span class="pre">remove</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">obj_id</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">obj</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#hashindex.mutable_field.MutableFieldIndex.remove" title="Permalink to this definition">¶</a></dt>
<dd><p>Remove a single object from the index.</p>
<p>If a bucket ever gets empty, remove it.</p>
</dd></dl>

</dd></dl>

</section>
<section id="module-hashindex.utils">
<span id="hashindex-utils-module"></span><h2>hashindex.utils module<a class="headerlink" href="#module-hashindex.utils" title="Permalink to this headline">¶</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="hashindex.utils.get_attributes">
<span class="sig-prename descclassname"><span class="pre">hashindex.utils.</span></span><span class="sig-name descname"><span class="pre">get_attributes</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cls</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#hashindex.utils.get_attributes" title="Permalink to this definition">¶</a></dt>
<dd><p>Helper function to grab the attributes of a class</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="hashindex.utils.get_field">
<span class="sig-prename descclassname"><span class="pre">hashindex.utils.</span></span><span class="sig-name descname"><span class="pre">get_field</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">obj</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">field</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#hashindex.utils.get_field" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="hashindex.utils.validate_query">
<span class="sig-prename descclassname"><span class="pre">hashindex.utils.</span></span><span class="sig-name descname"><span class="pre">validate_query</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">indices</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">match</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Callable</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">exclude</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Callable</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#hashindex.utils.validate_query" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</section>
<section id="module-hashindex">
<span id="module-contents"></span><h2>Module contents<a class="headerlink" href="#module-hashindex" title="Permalink to this headline">¶</a></h2>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">hashindex</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2022, Theo Walker.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.5.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/render/hashindex.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>